--- PNG_codec.cpp	2017-03-08 08:14:14.000000000 +0000
+++ PNG_codec_palette.cpp	2017-03-08 08:14:05.000000000 +0000
@@ -63,6 +63,13 @@
         infop = png_create_info_struct(pngp);
         png_set_read_fn(pngp, &src, get_data);
         png_read_info(pngp, infop);
+
+        if (infop->color_type == PNG_COLOR_TYPE_PALETTE) {
+           png_set_palette_to_rgb(pngp); // Palette to RGB
+           png_set_tRNS_to_alpha(pngp);  // transparency palette to Alpha
+           png_set_add_alpha(pngp, 255, PNG_FILLER_AFTER); // Add alpha if not there
+           png_read_update_info(pngp, infop); // update the reader
+        }
         
 // TODO: Decode to expected format
 //        png_set_palette_to_rgb(pngp); // Palette to RGB
@@ -75,8 +82,12 @@
 
         if (raster.pagesize.y != height || raster.pagesize.x != width)
             throw "Input PNG has the wrong size";
-        if (png_get_rowbytes(pngp, infop) != params.line_stride)
+        if (infop->color_type == PNG_COLOR_TYPE_PALETTE)
+            if (raster.pagesize.x * 4 != png_get_rowbytes(pngp, infop))
+                throw "Wrong type of data in PNG encode";
+        else if (png_get_rowbytes(pngp, infop) != params.line_stride)
             throw "Wrong type of data in PNG encode";
+        
 
         png_read_image(pngp, png_rowp.data());
         png_read_end(pngp, infop);
